<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: layout(content=~{::section}, title='Motos')}">
<section>
    <div style="display:flex;gap:1rem;align-items:center">
        <h1>Motos</h1>

        <form method="get">
            <select name="status" onchange="this.form.submit()">
                <option value="" th:selected="${status==null}">Todos</option>

                <option th:each="s : ${T(com.mottu.mottuguard.enums.MotoStatus).values()}"
                        th:value="${s}" th:text="${s}" th:selected="${status==s}"></option>
            </select>
        </form>

        <a class="btn" th:href="@{/motos/new}">+ Nova</a>
    </div>

    <table>
        <thead><tr><th>ID</th><th>Placa</th><th>Modelo</th><th>Status</th><th>Tag</th><th>Ações</th></tr></thead>
        <tbody>
        <tr th:each="m : ${motos}">
            <td th:text="${m.id}"></td>
            <td th:text="${m.placa}"></td>
            <td th:text="${m.modelo}"></td>
            <td th:text="${m.status}"></td>
            <td th:text="${m.uwbTag != null ? m.uwbTag.eui64 : '-'}"></td>
            <td>
                <a th:href="@{/motos/{id}/edit(id=${m.id})}">Editar</a>

                <form th:action="@{/motos/{id}/delete(id=${m.id})}" method="post" style="display:inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" onclick="return confirm('Excluir?')">Excluir</button>
                </form>

                <span th:if="${m.status.name() != 'Reservada'}">
              <form th:action="@{/motos/{id}/reservar(id=${m.id})}" method="post" style="display:inline">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit">Reservar</button>
              </form>
            </span>

                <span th:if="${m.status.name() == 'Reservada'}">
              <form th:action="@{/motos/{id}/liberar(id=${m.id})}" method="post" style="display:inline">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit">Liberar</button>
              </form>
            </span>

                <a th:href="@{/motos/{id}/assign(id=${m.id})}">Vincular Tag</a>

                <form th:action="@{/motos/{id}/unassign(id=${m.id})}" method="post" style="display:inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit">Remover Tag</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</section>
</html>
